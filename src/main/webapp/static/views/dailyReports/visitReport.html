<div class="section-header">
    <h1 class="h3 section-text">Visit Report</h1>
</div>
<div class="bg-white clearfix">
    <div class="pull-left dropdown no-m no-p" uib-dropdown col-sm-4>
        <button class="btn btn-default no-border-i box-border-r-light dropdown-toggle no-b-rad-i" uib-dropdown-toggle>
            Columns <i class="fa fa-angle-double-down"></i>
        </button>
        <ul uib-dropdown-menu class="dropdown-menu dropdown-alt">
            <li><a data-ng-click ="showDealerName = !showDealerName"><i class="fa" data-ng-class="{'fa-check':!showDealerName, 'fa-times':showDealerName}"></i> Dealer Name </a></li>
            <li><a data-ng-click ="showSiteUrl = !showSiteUrl"><i class="fa" data-ng-class="{'fa-check':!showSiteUrl, 'fa-times':showSiteUrl}"></i> Site URL </a></li>
            <li><a data-ng-click ="showVisitTime = !showVisitTime"><i class="fa" data-ng-class="{'fa-check':!showVisitTime, 'fa-times':showVisitTime}"></i> Visit Time </a></li>                   
            <!--            <li><a data-ng-click ="showSessionCookie = !showSessionCookie"><i class="fa" data-ng-class="{'fa-check':!showSessionCookie, 'fa-times':showSessionCookie}"></i> Session Cookie </a></li>                   
                        <li><a data-ng-click ="showFingerPrint = !showFingerPrint"><i class="fa" data-ng-class="{'fa-check':!showFingerPrint, 'fa-times':showFingerPrint}"></i> Device Fingerprint </a></li>                   -->
            <li><a data-ng-click ="showDeviceType = !showDeviceType"><i class="fa" data-ng-class="{'fa-check':!showDeviceType, 'fa-times':showDeviceType}"></i> Device Type </a></li>                   
            <li><a data-ng-click ="showIpAddress = !showIpAddress"><i class="fa" data-ng-class="{'fa-check':!showIpAddress, 'fa-times':showIpAddress}"></i> IpAddress </a></li>                   
            <li><a data-ng-click ="showCity = !showCity"><i class="fa" data-ng-class="{'fa-check':!showCity, 'fa-times':showCity}"></i> City </a></li>                   
            <li><a data-ng-click ="showRefererSite = !showRefererSite"><i class="fa" data-ng-class="{'fa-check':!showRefererSite, 'fa-times':showRefererSite}"></i> Referer Site </a></li>                   
        </ul>
    </div>
    <div class="col-sm-10">
        <input type="text" class="form-control no-border no-bg no-shadow" placeholder="Search..." data-ng-model="search">
    </div> 
</div>
<div class="wrapper" data-ng-controller="VisitReportController">
    <div class="panel panel-default">
        <div class="panel-body no-p">
            <div class="table-container">
                <table st-table="dealer" class="table table-striped no-m table-hover">
                    <thead>
                        <tr>
                            <th data-ng-hide="showDealerName" data-ng-click="changeSorting('dealerName');
                                                dealerName = !dealerName" style="cursor: pointer">
                                Dealer Name
                                <i class="fa pull-right" data-ng-class="{'fa-caret-down':!dealerName, 'fa-caret-up':dealerName}"></i>
                            </th>
                            <th data-ng-hide="showSiteUrl" data-ng-click="changeSorting('url');
                                                url = !url" style="cursor: pointer">
                                Url
                                <i class="fa pull-right" data-ng-class="{'fa-caret-down':!url, 'fa-caret-up':url}"></i>
                            </th>
                            <th data-ng-hide="showVisitTime" data-ng-click="changeSorting('visitTime');
                                                visitTime = !visitTime" style="cursor: pointer">
                                Visit Time
                                <i class="fa pull-right" data-ng-class="{'fa-caret-down':!visitTime, 'fa-caret-up':visitTime}"></i>
                            </th>
                            <!--                            <th data-ng-hide="showSessionCookie" data-ng-click="changeSorting('sessionCookie');
                                                                            sessionCookie = !sessionCookie" style="cursor: pointer">
                                                            Cookie
                                                            <i class="fa pull-right" data-ng-class="{'fa-caret-down':!sessionCookie, 'fa-caret-up':sessionCookie}"></i>
                                                        </th>
                                                        <th data-ng-hide="showFingerPrint" data-ng-click="changeSorting('deviceFingerprint');
                                                                            deviceFingerprint = !deviceFingerprint" style="cursor: pointer">
                                                            Fingerprint
                                                            <i class="fa pull-right" data-ng-class="{'fa-caret-down':!deviceFingerprint, 'fa-caret-up':deviceFingerprint}"></i>
                                                        </th>-->
                            <th data-ng-hide="showDeviceType" data-ng-click="changeSorting('deviceType');
                                                deviceType = !deviceType" style="cursor: pointer">
                                Device Type
                                <i class="fa pull-right" data-ng-class="{'fa-caret-down':!deviceType, 'fa-caret-up':deviceType}"></i>
                            </th>
                            <th data-ng-hide="showIpAddress" data-ng-click="changeSorting('ipAddress');
                                                ipAddress = !ipAddress" style="cursor: pointer">
                                IpAddress
                                <i class="fa pull-right" data-ng-class="{'fa-caret-down':!ipAddress, 'fa-caret-up':ipAddress}"></i>
                            </th>
                            <th data-ng-hide="showCity" data-ng-click="changeSorting('city');
                                                city = !city" style="cursor: pointer">
                                City
                                <i class="fa pull-right" data-ng-class="{'fa-caret-down':!city, 'fa-caret-up':city}"></i>
                            </th>
                            <th data-ng-hide="showRefererSite" data-ng-click="changeSorting('refererUrl');
                                                refererSite = !refererSite" style="cursor: pointer">
                                Referrer Site
                                <i class="fa pull-right" data-ng-class="{'fa-caret-down':!refererSite, 'fa-caret-up':refererSite}"></i>
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr dir-paginate="visitReport in visitReports | orderBy:sort.column:sort.descending | filter:search | itemsPerPage: pageSize" current-page="currentPage">
                            <td data-ng-hide="showDealerName">{{visitReport.dealerName}}</td>
                            <td data-ng-hide="showSiteUrl" 
                                ns-popover
                                ns-popover-template="visitUrlTooltip"
                                ns-popover-trigger="mouseenter"
                                ns-popover-theme="ns-popover-tooltip-theme"
                                ns-popover-timeout="1"
                                ns-popover-placement="top">                                
                                {{visitReport.url| limitTo: 15 }}{{visitReport.url.length < 15? "":"..."}}
                            </td>
                            <td data-ng-hide="showVisitTime"
                                ns-popover
                                ns-popover-template="visitTimeTooltip"
                                ns-popover-trigger="mouseenter"
                                ns-popover-theme="ns-popover-tooltip-theme"
                                ns-popover-timeout="1"
                                ns-popover-placement="top">
                                {{visitReport.visitTime| date: "dd/MM/yyyy hh:mm:ss"}}
                            </td>
                            <!--                            <td data-ng-hide="showSessionCookie">{{visitReport.sessionCookie}}</td>
                                                        <td data-ng-hide="showFingerPrint">{{visitReport.deviceFingerprint}}</td>-->
                            <td data-ng-hide="showDeviceType">{{visitReport.deviceType}}</td>
                            <td data-ng-hide="showIpAddress">{{visitReport.ipAddress}}</td>
                            <td data-ng-hide="showCity" 
                                ns-popover
                                ns-popover-template="visitCityTooltip"
                                ns-popover-trigger="mouseenter"
                                ns-popover-theme="ns-popover-tooltip-theme"
                                ns-popover-timeout="1"
                                ns-popover-placement="top">
                                {{visitReport.city}}
                            </td>

                            <td data-ng-hide="showRefererSite"
                                ns-popover
                                ns-popover-template="visitRefererUrlTooltip"
                                ns-popover-trigger="mouseenter"
                                ns-popover-theme="ns-popover-tooltip-theme"
                                ns-popover-timeout="1"
                                ns-popover-placement="top">                                
                                {{visitReport.refererUrl| limitTo: 11}}{{visitReport.refererUrl.length < 11 ? "":"..."}}</td>                            

                    <script type="text/ng-template" id="visitCityTooltip">
                        <div class="triangle"></div>
                        <div class="ns-popover-tooltip">
                        Zip Code : {{visitReport.zipCode}}, 
                        Country : {{visitReport.country}},
                        </div>
                    </script>
                    <script type="text/ng-template" id="visitTimeTooltip">
                        <div class="triangle"></div>
                        <div class="ns-popover-tooltip">
                        Time Zone : {{visitReport.timeZone}}, 
                        Visiter Local Time : {{visitReport.visiterLocalTime}}, 
                        Location Time Zone : {{visitReport.locationTimeZone}}
                        </div>
                    </script>
                    <script type="text/ng-template" id="visitUrlTooltip">
                        <div class="triangle"></div>
                        <div class="ns-popover-tooltip">
                        Url : {{visitReport.url}}"
                        </div>
                    </script> 
                    <script type="text/ng-template" id="visitRefererUrlTooltip">
                        <div class="triangle"></div>
                        <div class="ns-popover-tooltip">
                        Referer Url : "{{visitReport.refererUrl}}"
                        </div>
                    </script>
                    </tr>
                    </tbody>
                </table>
            </div>
            <div>
                <dir-pagination-controls boundary-links="true" on-page-change="pageChangeHandler(newPageNumber)" template-url="views/dailyReports/pagination.tpl.html"></dir-pagination-controls>
            </div>
        </div>
    </div>
</div>

